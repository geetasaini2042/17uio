<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <title>Push Notification Demo</title>
</head>
<body>
  <h1>GitHub Pages + PHP Push Demo</h1>
  <p>Browser ‡§™‡§∞ push notification subscribe ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡•Ä‡§ö‡•á ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç:</p>
  <button id="subscribe">Subscribe</button>

  <h3>Status / Debug:</h3>
  <pre id="status"></pre>

  <script>
    const statusEl = document.getElementById("status");

    // ‡§Ö‡§™‡§®‡•Ä VAPID Public Key ‡§°‡§æ‡§≤‡•á‡§Ç
    const publicVapidKey = "BPl6x1qYR8I3HqZpdC306TBcmpOycTYC9JTBm69Qjj4VqAkiCJ6tqpOM2wh4ZBBicq6HTxnLCauXgkfTvFD2HAk";

    function logStatus(msg) {
      statusEl.textContent += msg + "\n";
    }

    async function subscribeUser() {
      try {
        logStatus("1Ô∏è‚É£ Registering service worker...");
        const register = await navigator.serviceWorker.register("service-worker.js");
        logStatus("‚úÖ Service worker registered");

        const permission = await Notification.requestPermission();
        logStatus("Permission: " + permission);
        if (permission !== "granted") {
          logStatus("‚ùå Notification permission denied!");
          return;
        }

        const subscription = await register.pushManager.subscribe({
          userVisibleOnly: true,
          applicationServerKey: urlBase64ToUint8Array(publicVapidKey)
        });
        logStatus("‚úÖ Subscription object created");

        const res = await fetch("http://127.0.0.1:8000/save-subscription.php", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(subscription)
        });

        const data = await res.json();
        logStatus("Response from PHP: " + JSON.stringify(data));

        if (data.success) {
          logStatus("üéâ Subscribed successfully!");
        } else {
          logStatus("‚ùå Subscription failed!");
        }

      } catch (err) {
        logStatus("‚ùå Error: " + err.message);
      }
    }

    document.getElementById("subscribe").addEventListener("click", subscribeUser);

    function urlBase64ToUint8Array(base64String) {
      const padding = "=".repeat((4 - base64String.length % 4) % 4);
      const base64 = (base64String + padding).replace(/\-/g, "+").replace(/_/g, "/");
      const rawData = atob(base64);
      return Uint8Array.from([...rawData].map(c => c.charCodeAt(0)));
    }
  </script>
</body>
</html>
